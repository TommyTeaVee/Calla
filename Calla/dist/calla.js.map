{"version":3,"file":"calla.js","sources":["../../Kudzu/typeChecks.ts","../audio/canChangeAudioOutput.ts","../../Kudzu/arrays/arrayRemoveAt.ts","../../Kudzu/events/EventBase.ts","../../Kudzu/events/sleep.ts","../CallaEvents.ts","../ConnectionState.ts","../meta/BaseMetadataClient.ts","../../Kudzu/arrays/arrayScan.ts","../tele/BaseTeleconferenceClient.ts","../audio/AudioActivityEvent.ts","../Calla.ts","../index.ts"],"sourcesContent":["function t(o: any, s: string, c: Function) {\r\n    return typeof o === s\r\n        || o instanceof c;\r\n}\r\n\r\nexport function isFunction(obj: any): obj is Function {\r\n    return t(obj, \"function\", Function);\r\n}\r\n\r\nexport function isString(obj: any): obj is string {\r\n    return t(obj, \"string\", String);\r\n}\r\n\r\nexport function isBoolean(obj: any): obj is boolean {\r\n    return t(obj, \"boolean\", Boolean);\r\n}\r\n\r\nexport function isNumber(obj: any): obj is number {\r\n    return t(obj, \"number\", Number);\r\n}\r\n\r\nexport function isObject(obj: any): obj is object {\r\n    return t(obj, \"object\", Object);\r\n}\r\n\r\nexport function isDate(obj: any): obj is Date {\r\n    return obj instanceof Date;\r\n}\r\n\r\nexport function isArray(obj: any): obj is Array<any> {\r\n    return obj instanceof Array;\r\n}\r\n\r\nexport function isHTMLElement(obj: any): obj is HTMLElement {\r\n    return obj instanceof HTMLElement;\r\n}\r\n\r\nexport function assertNever(x: never, msg?: string): never {\r\n    throw new Error((msg || \"Unexpected object: \") + x);\r\n}\r\n\r\n/**\r\n * Check a value to see if it is of a number type\r\n * and is not the special NaN value.\r\n */\r\nexport function isGoodNumber(obj: any): obj is number {\r\n    return isNumber(obj)\r\n        && !Number.isNaN(obj);\r\n}\r\n\r\nexport function isEventListener(obj: EventListenerOrEventListenerObject): obj is EventListener {\r\n    return isFunction(obj);\r\n}\r\n\r\nexport function isEventListenerObject(obj: EventListenerOrEventListenerObject): obj is EventListenerObject {\r\n    return !isEventListener(obj);\r\n}\r\n\r\nexport function isNullOrUndefined(obj: any): obj is null | undefined {\r\n    return obj === null\r\n        || obj === undefined;\r\n}","import { isFunction } from \"kudzu/typeChecks\";\r\n\r\n/**\r\n * Indicates whether or not the current browser can change the destination device for audio output.\r\n **/\r\nexport const canChangeAudioOutput = isFunction((HTMLAudioElement.prototype as any).setSinkId);","/**\r\n * Removes an item at the given index from an array.\r\n */\r\nexport function arrayRemoveAt<T>(arr: T[], idx: number) {\r\n    return arr.splice(idx, 1)[0];\r\n}","import { arrayRemoveAt } from \"../arrays/arrayRemoveAt\";\r\nimport { isFunction } from \"../typeChecks\";\r\n\r\nexport class EventBase implements EventTarget {\r\n    private listeners = new Map<string, Function[]>();\r\n    private listenerOptions = new Map<Function, AddEventListenerOptions>();\r\n\r\n    addEventListener(type: string, callback: (evt: Event) => any, options?: AddEventListenerOptions): void {\r\n        if (isFunction(callback)) {\r\n            let listeners = this.listeners.get(type);\r\n            if (!listeners) {\r\n                listeners = new Array<Function>();\r\n                this.listeners.set(type, listeners);\r\n            }\r\n\r\n            if (!listeners.find(c => c === callback)) {\r\n                listeners.push(callback);\r\n\r\n                if (options) {\r\n                    this.listenerOptions.set(callback, options);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    removeEventListener(type: string, callback: (evt: Event) => any) {\r\n        if (isFunction(callback)) {\r\n            const listeners = this.listeners.get(type);\r\n            if (listeners) {\r\n                this.removeListener(listeners, callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    private removeListener(listeners: Function[], callback: Function) {\r\n        const idx = listeners.findIndex(c => c === callback);\r\n        if (idx >= 0) {\r\n            arrayRemoveAt(listeners, idx);\r\n            if (this.listenerOptions.has(callback)) {\r\n                this.listenerOptions.delete(callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    dispatchEvent(evt: Event): boolean {\r\n        const listeners = this.listeners.get(evt.type);\r\n        if (listeners) {\r\n            for (const callback of listeners) {\r\n                const options = this.listenerOptions.get(callback);\r\n                if (options && options.once) {\r\n                    this.removeListener(listeners, callback);\r\n                }\r\n\r\n                callback.call(this, evt);\r\n            }\r\n        }\r\n        return !evt.defaultPrevented;\r\n    }\r\n}\r\n\r\nexport class TypedEvent<T extends string> extends Event {\r\n    constructor(type: T) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class TypedEventBase<EventsT> extends EventBase {\r\n    private mappedCallbacks = new Map<Function, (evt: Event) => any>();\r\n\r\n    addEventListener<K extends string & keyof EventsT>(type: K, callback: (evt: TypedEvent<K> & EventsT[K]) => any, options?: AddEventListenerOptions): void {\r\n        let mappedCallback = this.mappedCallbacks.get(callback);\r\n        if (mappedCallback == null) {\r\n            mappedCallback = (evt: Event) => callback(evt as TypedEvent<K> & EventsT[K]);\r\n            this.mappedCallbacks.set(callback, mappedCallback);\r\n        }\r\n\r\n        super.addEventListener(type, mappedCallback, options);\r\n    }\r\n\r\n    removeEventListener<K extends string & keyof EventsT>(type: K, callback: (evt: TypedEvent<K> & EventsT[K]) => any) {\r\n        const mappedCallback = this.mappedCallbacks.get(callback);\r\n        if (mappedCallback) {\r\n            super.removeEventListener(type, mappedCallback);\r\n        }\r\n    }\r\n}","export function sleep(dt: number) : Promise<void> {\r\n    return new Promise((resolve) => {\r\n        setTimeout(resolve, dt);\r\n    });\r\n}\r\n","import { Emoji } from \"kudzu/emoji/Emoji\";\r\nimport type { AudioActivityEvent } from \"./audio/AudioActivityEvent\";\r\nimport type { InterpolatedPose } from \"./audio/positions/InterpolatedPose\";\r\nimport { AudioStreamSource } from \"./audio/sources/AudioStreamSource\";\r\n\r\nexport type CallaTeleconferenceEventType = \"serverConnected\"\r\n    | \"serverDisconnected\"\r\n    | \"serverFailed\"\r\n    | \"conferenceConnected\"\r\n    | \"conferenceJoined\"\r\n    | \"conferenceFailed\"\r\n    | \"conferenceRestored\"\r\n    | \"conferenceLeft\"\r\n    | \"participantJoined\"\r\n    | \"participantLeft\"\r\n    | \"userNameChanged\"\r\n    | \"audioMuteStatusChanged\"\r\n    | \"videoMuteStatusChanged\"\r\n    | \"audioActivity\"\r\n    | \"audioAdded\"\r\n    | \"audioRemoved\"\r\n    | \"videoAdded\"\r\n    | \"videoRemoved\";\r\n\r\nexport type CallaMetadataEventType = \"userPosed\"\r\n    | \"userPointer\"\r\n    | \"setAvatarEmoji\"\r\n    | \"avatarChanged\"\r\n    | \"emote\"\r\n    | \"chat\";\r\n\r\nexport type CallaEventType = CallaTeleconferenceEventType | CallaMetadataEventType;\r\n\r\nexport class CallaEvent<T extends CallaEventType> extends Event {\r\n    constructor(public eventType: T) {\r\n        super(eventType);\r\n    }\r\n}\r\n\r\nexport class CallaTeleconferenceServerConnectedEvent\r\n    extends CallaEvent<\"serverConnected\"> {\r\n    constructor() {\r\n        super(\"serverConnected\");\r\n    }\r\n}\r\n\r\nexport class CallaTeleconferenceServerDisconnectedEvent\r\n    extends CallaEvent<\"serverDisconnected\"> {\r\n    constructor() {\r\n        super(\"serverDisconnected\");\r\n    }\r\n}\r\n\r\nexport class CallaTeleconferenceServerFailedEvent\r\n    extends CallaEvent<\"serverFailed\"> {\r\n    constructor() {\r\n        super(\"serverFailed\");\r\n    }\r\n}\r\n\r\nexport class CallaUserEvent<T extends CallaEventType> extends CallaEvent<T> {\r\n    constructor(type: T, public id: string) {\r\n        super(type);\r\n    }\r\n}\r\n\r\nexport class CallaParticipantEvent<T extends CallaTeleconferenceEventType> extends CallaUserEvent<T> {\r\n    constructor(type: T, id: string, public displayName: string) {\r\n        super(type, id);\r\n    }\r\n}\r\n\r\nexport class CallaUserNameChangedEvent extends CallaUserEvent<\"userNameChanged\"> {\r\n    constructor(id: string, public displayName: string) {\r\n        super(\"userNameChanged\", id);\r\n    }\r\n}\r\n\r\nexport class CallaConferenceJoinedEvent extends CallaUserEvent<\"conferenceJoined\"> {\r\n    constructor(id: string, public pose: InterpolatedPose) {\r\n        super(\"conferenceJoined\", id);\r\n    }\r\n}\r\n\r\nexport class CallaConferenceLeftEvent extends CallaUserEvent<\"conferenceLeft\"> {\r\n    constructor(id: string) {\r\n        super(\"conferenceLeft\", id);\r\n    }\r\n}\r\n\r\nexport class CallaConferenceConnectedEvent extends CallaEvent<\"conferenceConnected\"> {\r\n    constructor() {\r\n        super(\"conferenceConnected\");\r\n    }\r\n}\r\n\r\nexport class CallaConferenceFailedEvent extends CallaEvent<\"conferenceFailed\">{\r\n    constructor() {\r\n        super(\"conferenceFailed\");\r\n    }\r\n}\r\n\r\nexport class CallaConferenceRestoredEvent extends CallaEvent<\"conferenceRestored\">{\r\n    constructor() {\r\n        super(\"conferenceRestored\");\r\n    }\r\n}\r\n\r\nexport class CallaParticipantJoinedEvent extends CallaParticipantEvent<\"participantJoined\"> {\r\n    constructor(id: string, displayName: string, public source: AudioStreamSource) {\r\n        super(\"participantJoined\", id, displayName);\r\n    }\r\n}\r\n\r\nexport class CallaParticipantLeftEvent extends CallaUserEvent<\"participantLeft\"> {\r\n    constructor(id: string) {\r\n        super(\"participantLeft\", id);\r\n    }\r\n}\r\n\r\nexport class CallaParticipantNameChangeEvent extends CallaParticipantEvent<\"userNameChanged\"> {\r\n    constructor(id: string, displayName: string) {\r\n        super(\"userNameChanged\", id, displayName);\r\n    }\r\n}\r\n\r\nexport class CallaUserMutedEvent<T extends CallaTeleconferenceEventType> extends CallaUserEvent<T> {\r\n    constructor(type: T, id: string, public muted: boolean) {\r\n        super(type, id);\r\n    }\r\n}\r\n\r\nexport class CallaUserAudioMutedEvent extends CallaUserMutedEvent<\"audioMuteStatusChanged\"> {\r\n    constructor(id: string, muted: boolean) {\r\n        super(\"audioMuteStatusChanged\", id, muted);\r\n    }\r\n}\r\n\r\nexport class CallaUserVideoMutedEvent extends CallaUserMutedEvent<\"videoMuteStatusChanged\"> {\r\n    constructor(id: string, muted: boolean) {\r\n        super(\"videoMuteStatusChanged\", id, muted);\r\n    }\r\n}\r\n\r\nexport enum StreamType {\r\n    Audio = \"audio\",\r\n    Video = \"video\"\r\n}\r\n\r\nexport enum StreamOpType {\r\n    Added = \"added\",\r\n    Removed = \"removed\",\r\n    Changed = \"changed\"\r\n}\r\n\r\nexport class CallaStreamEvent<T extends CallaTeleconferenceEventType> extends CallaUserEvent<T> {\r\n    constructor(type: T, public kind: StreamType, public op: StreamOpType, id: string, public stream: MediaStream) {\r\n        super(type, id);\r\n    }\r\n}\r\n\r\nexport class CallaStreamAddedEvent<T extends CallaTeleconferenceEventType> extends CallaStreamEvent<T> {\r\n    constructor(type: T, kind: StreamType, id: string, stream: MediaStream) {\r\n        super(type, kind, StreamOpType.Added, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaStreamRemovedEvent<T extends CallaTeleconferenceEventType> extends CallaStreamEvent<T> {\r\n    constructor(type: T, kind: StreamType, id: string, stream: MediaStream) {\r\n        super(type, kind, StreamOpType.Removed, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaStreamChangedEvent<T extends CallaTeleconferenceEventType> extends CallaStreamEvent<T> {\r\n    constructor(type: T, kind: StreamType, id: string, stream: MediaStream) {\r\n        super(type, kind, StreamOpType.Changed, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaAudioStreamAddedEvent extends CallaStreamAddedEvent<\"audioAdded\"> {\r\n    constructor(id: string, stream: MediaStream) {\r\n        super(\"audioAdded\", StreamType.Audio, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaAudioStreamRemovedEvent extends CallaStreamRemovedEvent<\"audioRemoved\"> {\r\n    constructor(id: string, stream: MediaStream) {\r\n        super(\"audioRemoved\", StreamType.Audio, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaVideoStreamAddedEvent extends CallaStreamAddedEvent<\"videoAdded\"> {\r\n    constructor(id: string, stream: MediaStream) {\r\n        super(\"videoAdded\", StreamType.Video, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaVideoStreamRemovedEvent extends CallaStreamRemovedEvent<\"videoRemoved\"> {\r\n    constructor(id: string, stream: MediaStream) {\r\n        super(\"videoRemoved\", StreamType.Video, id, stream);\r\n    }\r\n}\r\n\r\nexport class CallaPoseEvent<T extends CallaMetadataEventType> extends CallaUserEvent<T> {\r\n    constructor(type: T, id: string, public px: number, public py: number, public pz: number, public fx: number, public fy: number, public fz: number, public ux: number, public uy: number, public uz: number) {\r\n        super(type, id);\r\n    }\r\n\r\n    set(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number) {\r\n        this.px = px;\r\n        this.py = py;\r\n        this.pz = pz;\r\n        this.fx = fx;\r\n        this.fy = fy;\r\n        this.fz = fz;\r\n        this.ux = ux;\r\n        this.uy = uy;\r\n        this.uz = uz;\r\n    }\r\n}\r\n\r\nexport class CallaUserPosedEvent extends CallaPoseEvent<\"userPosed\"> {\r\n    constructor(id: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number) {\r\n        super(\"userPosed\", id, px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n}\r\n\r\nexport class CallaUserPointerEvent extends CallaPoseEvent<\"userPointer\"> {\r\n    constructor(id: string, public name: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number) {\r\n        super(\"userPointer\", id, px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n}\r\n\r\nexport class CallaEmojiEvent<T extends CallaMetadataEventType> extends CallaUserEvent<T> {\r\n    emoji: string;\r\n    constructor(type: T, id: string, emoji: Emoji | string) {\r\n        super(type, id);\r\n        if (emoji instanceof Emoji) {\r\n            this.emoji = emoji.value;\r\n        }\r\n        else {\r\n            this.emoji = emoji;\r\n        }\r\n    }\r\n}\r\n\r\nexport class CallaEmoteEvent extends CallaEmojiEvent<\"emote\"> {\r\n    constructor(id: string, emoji: Emoji | string) {\r\n        super(\"emote\", id, emoji);\r\n    }\r\n}\r\n\r\nexport class CallaEmojiAvatarEvent extends CallaEmojiEvent<\"setAvatarEmoji\"> {\r\n    constructor(id: string, emoji: Emoji | string) {\r\n        super(\"setAvatarEmoji\", id, emoji);\r\n    }\r\n}\r\n\r\nexport class CallaAvatarChangedEvent extends CallaUserEvent<\"avatarChanged\"> {\r\n    constructor(id: string, public url: string) {\r\n        super(\"avatarChanged\", id);\r\n    }\r\n}\r\n\r\nexport class CallaChatEvent extends CallaUserEvent<\"chat\"> {\r\n    constructor(id: string, public text: string) {\r\n        super(\"chat\", id);\r\n    }\r\n}\r\n\r\nexport interface CallaTeleconferenceEvents {\r\n    serverConnected: CallaTeleconferenceServerConnectedEvent;\r\n    serverDisconnected: CallaTeleconferenceServerDisconnectedEvent;\r\n    serverFailed: CallaTeleconferenceServerFailedEvent;\r\n    audioMuteStatusChanged: CallaUserAudioMutedEvent;\r\n    videoMuteStatusChanged: CallaUserVideoMutedEvent;\r\n    conferenceConnected: CallaConferenceConnectedEvent;\r\n    conferenceJoined: CallaConferenceJoinedEvent;\r\n    conferenceLeft: CallaConferenceLeftEvent;\r\n    conferenceFailed: CallaConferenceFailedEvent;\r\n    conferenceRestored: CallaConferenceRestoredEvent;\r\n    participantJoined: CallaParticipantJoinedEvent;\r\n    participantLeft: CallaParticipantLeftEvent;\r\n    userNameChanged: CallaUserNameChangedEvent;\r\n    audioActivity: AudioActivityEvent;\r\n    audioAdded: CallaAudioStreamAddedEvent;\r\n    videoAdded: CallaVideoStreamAddedEvent;\r\n    audioRemoved: CallaAudioStreamRemovedEvent;\r\n    videoRemoved: CallaVideoStreamRemovedEvent;\r\n}\r\n\r\nexport interface CallaMetadataEvents {\r\n    userPosed: CallaUserPosedEvent;\r\n    userPointer: CallaUserPointerEvent;\r\n    emote: CallaEmoteEvent;\r\n    setAvatarEmoji: CallaEmojiAvatarEvent;\r\n    avatarChanged: CallaAvatarChangedEvent;\r\n    chat: CallaChatEvent;\r\n}\r\n\r\nexport interface CallaClientEvents extends CallaTeleconferenceEvents, CallaMetadataEvents { }","export enum ConnectionState {\r\n    Disconnected = \"Disconnected\",\r\n    Connecting = \"Connecting\",\r\n    Connected = \"Connected\",\r\n    Disconnecting = \"Disconnecting\"\r\n}","import type { Emoji } from \"kudzu/emoji/Emoji\";\r\nimport { TypedEventBase } from \"kudzu/events/EventBase\";\r\nimport { sleep } from \"kudzu/events/sleep\";\r\nimport type { CallaEventType, CallaMetadataEvents } from \"../CallaEvents\";\r\nimport { CallaUserEvent } from \"../CallaEvents\";\r\nimport { ConnectionState } from \"../ConnectionState\";\r\nimport type { IMetadataClientExt } from \"./IMetadataClient\";\r\n\r\n\r\nexport abstract class BaseMetadataClient\r\n    extends TypedEventBase<CallaMetadataEvents>\r\n    implements IMetadataClientExt {\r\n\r\n    private tasks = new Map<string, Promise<any>>();\r\n\r\n    constructor(private sleepTime: number) {\r\n        super();\r\n    }\r\n\r\n    async getNext<T extends keyof CallaMetadataEvents>(evtName: T, userID: string): Promise<CallaMetadataEvents[T]> {\r\n        return new Promise((resolve) => {\r\n            const getter = (evt: CallaMetadataEvents[T]) => {\r\n                if (evt instanceof CallaUserEvent\r\n                    && evt.id === userID) {\r\n                    this.removeEventListener(evtName, getter);\r\n                    resolve(evt);\r\n                }\r\n            };\r\n\r\n            this.addEventListener(evtName, getter);\r\n        });\r\n    }\r\n\r\n    abstract get metadataState(): ConnectionState;\r\n\r\n    get isConnected(): boolean {\r\n        return this.metadataState === ConnectionState.Connected;\r\n    }\r\n\r\n    protected abstract callInternal(command: CallaEventType, ...args: any[]): Promise<void>;\r\n\r\n    private async callThrottled(key: string, command: CallaEventType, ...args: any[]): Promise<void> {\r\n        if (!this.tasks.has(key)) {\r\n            const start = performance.now();\r\n            const task = this.callInternal(command, ...args);\r\n            this.tasks.set(key, task);\r\n            await task;\r\n            const delta = performance.now() - start;\r\n            const sleepTime = this.sleepTime - delta;\r\n            if (sleepTime > 0) {\r\n                await sleep(this.sleepTime);\r\n            }\r\n            this.tasks.delete(key);\r\n        }\r\n    }\r\n\r\n    private async callImmediate(command: CallaEventType, ...args: any[]): Promise<void> {\r\n        await this.callInternal(command, ...args);\r\n    }\r\n\r\n    setLocalPose(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.callThrottled(\"userPosed\", \"userPosed\", px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setLocalPoseImmediate(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.callImmediate(\"userPosed\", px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setLocalPointer(name: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.callThrottled(\"userPointer\" + name, \"userPointer\", name, px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setAvatarEmoji(emoji: Emoji): void {\r\n        this.callImmediate(\"setAvatarEmoji\", emoji);\r\n    }\r\n\r\n    setAvatarURL(url: string): void {\r\n        this.callImmediate(\"avatarChanged\", url);\r\n    }\r\n\r\n    emote(emoji: Emoji): void {\r\n        this.callImmediate(\"emote\", emoji);\r\n    }\r\n\r\n    chat(text: string): void {\r\n        this.callImmediate(\"chat\", text);\r\n    }\r\n\r\n    abstract connect(): Promise<void>;\r\n    abstract join(roomName: string): Promise<void>;\r\n    abstract identify(userNameOrID: string): Promise<void>;\r\n    abstract leave(): Promise<void>;\r\n    abstract disconnect(): Promise<void>;\r\n}\r\n","/**\r\n * Scans through a series of filters to find an item that matches\r\n * any of the filters. The first item of the first filter that matches\r\n * will be returned.\r\n */\r\nexport function arrayScan<T>(arr: T[], ...tests: ((val: T) => boolean)[]) {\r\n    for (const test of tests) {\r\n        for (const item of arr) {\r\n            if (test(item)) {\r\n                return item;\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}","import { arrayScan } from \"kudzu/arrays/arrayScan\";\r\nimport type { ErsatzEventTarget } from \"kudzu/events/ErsatzEventTarget\";\r\nimport { TypedEventBase } from \"kudzu/events/EventBase\";\r\nimport { IFetcher } from \"kudzu/io/IFetcher\";\r\nimport { AudioManager } from \"../audio/AudioManager\";\r\nimport { canChangeAudioOutput } from \"../audio/canChangeAudioOutput\";\r\nimport type { MediaDeviceSet, MediaPermissionSet } from \"../Calla\";\r\nimport type { CallaTeleconferenceEvents } from \"../CallaEvents\";\r\nimport { CallaUserEvent } from \"../CallaEvents\";\r\nimport { ConnectionState } from \"../ConnectionState\";\r\nimport type { IMetadataClientExt } from \"../meta/IMetadataClient\";\r\nimport type { ITeleconferenceClientExt } from \"./ITeleconferenceClient\";\r\n\r\nexport function addLogger(obj: ErsatzEventTarget, evtName: string): void {\r\n    obj.addEventListener(evtName, (...rest: any[]) => {\r\n        if (loggingEnabled) {\r\n            console.log(\">== CALLA ==<\", evtName, ...rest);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nfunction filterDeviceDuplicates(devices: MediaDeviceInfo[]) {\r\n    const filtered = [];\r\n    for (let i = 0; i < devices.length; ++i) {\r\n        const a = devices[i];\r\n        let found = false;\r\n        for (let j = 0; j < filtered.length && !found; ++j) {\r\n            const b = filtered[j];\r\n            found = a.kind === b.kind && b.label.indexOf(a.label) > 0;\r\n        }\r\n\r\n        if (!found) {\r\n            filtered.push(a);\r\n        }\r\n    }\r\n\r\n    return filtered;\r\n}\r\n\r\nconst PREFERRED_AUDIO_OUTPUT_ID_KEY = \"calla:preferredAudioOutputID\";\r\nconst PREFERRED_AUDIO_INPUT_ID_KEY = \"calla:preferredAudioInputID\";\r\nconst PREFERRED_VIDEO_INPUT_ID_KEY = \"calla:preferredVideoInputID\";\r\n\r\nexport const DEFAULT_LOCAL_USER_ID = \"local-user\";\r\n\r\nlet loggingEnabled = window.location.hostname === \"localhost\"\r\n    || /\\bdebug\\b/.test(window.location.search);\r\n\r\nexport abstract class BaseTeleconferenceClient\r\n    extends TypedEventBase<CallaTeleconferenceEvents>\r\n    implements ITeleconferenceClientExt {\r\n\r\n    toggleLogging() {\r\n        loggingEnabled = !loggingEnabled;\r\n    }\r\n\r\n    localUserID: string = null;\r\n    localUserName: string = null;\r\n    roomName: string = null;\r\n\r\n    protected fetcher: IFetcher;\r\n\r\n    audio: AudioManager;\r\n\r\n    private _connectionState = ConnectionState.Disconnected;\r\n    private _conferenceState = ConnectionState.Disconnected;\r\n\r\n    hasAudioPermission = false;\r\n    hasVideoPermission = false;\r\n\r\n    get connectionState(): ConnectionState {\r\n        return this._connectionState;\r\n    }\r\n\r\n    private setConnectionState(state: ConnectionState): void {\r\n        this._connectionState = state;\r\n    }\r\n\r\n    get conferenceState(): ConnectionState {\r\n        return this._conferenceState;\r\n    }\r\n\r\n    private setConferenceState(state: ConnectionState): void {\r\n        this._conferenceState = state;\r\n    }\r\n\r\n    constructor(fetcher: IFetcher, audio: AudioManager, public needsAudioDevice = true, public needsVideoDevice = false) {\r\n        super();\r\n\r\n        this.fetcher = fetcher;\r\n\r\n        this.audio = audio;\r\n\r\n        this.addEventListener(\"serverConnected\", this.setConnectionState.bind(this, ConnectionState.Connected));\r\n        this.addEventListener(\"serverFailed\", this.setConnectionState.bind(this, ConnectionState.Disconnected));\r\n        this.addEventListener(\"serverDisconnected\", this.setConnectionState.bind(this, ConnectionState.Disconnected));\r\n\r\n        this.addEventListener(\"conferenceJoined\", this.setConferenceState.bind(this, ConnectionState.Connected));\r\n        this.addEventListener(\"conferenceFailed\", this.setConferenceState.bind(this, ConnectionState.Disconnected));\r\n        this.addEventListener(\"conferenceRestored\", this.setConferenceState.bind(this, ConnectionState.Connected));\r\n        this.addEventListener(\"conferenceLeft\", this.setConferenceState.bind(this, ConnectionState.Disconnected));\r\n    }\r\n\r\n    dispatchEvent<K extends string & keyof CallaTeleconferenceEvents>(evt: CallaTeleconferenceEvents[K] & Event): boolean {\r\n        if (evt instanceof CallaUserEvent\r\n            && (evt.id == null\r\n                || evt.id === \"local\")) {\r\n            if (this.localUserID === DEFAULT_LOCAL_USER_ID) {\r\n                evt.id = null;\r\n            }\r\n            else {\r\n                evt.id = this.localUserID;\r\n            }\r\n        }\r\n\r\n        return super.dispatchEvent(evt);\r\n    }\r\n\r\n    async getNext<T extends keyof CallaTeleconferenceEvents>(evtName: T, userID: string): Promise<CallaTeleconferenceEvents[T]> {\r\n        return new Promise((resolve) => {\r\n            const getter = (evt: CallaTeleconferenceEvents[T]) => {\r\n                if (evt instanceof CallaUserEvent\r\n                    && evt.id === userID) {\r\n                    this.removeEventListener(evtName, getter);\r\n                    resolve(evt);\r\n                }\r\n            };\r\n\r\n            this.addEventListener(evtName, getter);\r\n        });\r\n    }\r\n\r\n\r\n\r\n    get preferredAudioInputID(): string {\r\n        return localStorage.getItem(PREFERRED_AUDIO_INPUT_ID_KEY);\r\n    }\r\n\r\n    set preferredAudioInputID(v: string) {\r\n        localStorage.setItem(PREFERRED_AUDIO_INPUT_ID_KEY, v);\r\n    }\r\n\r\n    get preferredVideoInputID(): string {\r\n        return localStorage.getItem(PREFERRED_VIDEO_INPUT_ID_KEY);\r\n    }\r\n\r\n    set preferredVideoInputID(v: string) {\r\n        localStorage.setItem(PREFERRED_VIDEO_INPUT_ID_KEY, v);\r\n    }\r\n\r\n    async setPreferredDevices(): Promise<void> {\r\n        await this.setPreferredAudioInput(true);\r\n        await this.setPreferredVideoInput(false);\r\n        await this.setPreferredAudioOutput(true);\r\n    }\r\n\r\n    async getPreferredAudioInput(allowAny: boolean): Promise<MediaDeviceInfo> {\r\n        const devices = await this.getAudioInputDevices();\r\n        const device = arrayScan(\r\n            devices,\r\n            (d) => d.deviceId === this.preferredAudioInputID,\r\n            (d) => d.deviceId === \"communications\",\r\n            (d) => d.deviceId === \"default\",\r\n            (d) => allowAny && d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    async setPreferredAudioInput(allowAny: boolean): Promise<void> {\r\n        const device = await this.getPreferredAudioInput(allowAny);\r\n        if (device) {\r\n            await this.setAudioInputDevice(device);\r\n        }\r\n    }\r\n\r\n    async getPreferredVideoInput(allowAny: boolean): Promise<MediaDeviceInfo> {\r\n        const devices = await this.getVideoInputDevices();\r\n        const device = arrayScan(devices,\r\n            (d) => d.deviceId === this.preferredVideoInputID,\r\n            (d) => allowAny && d && /front/i.test(d.label),\r\n            (d) => allowAny && d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    async setPreferredVideoInput(allowAny: boolean): Promise<void> {\r\n        const device = await this.getPreferredVideoInput(allowAny);\r\n        if (device) {\r\n            await this.setVideoInputDevice(device);\r\n        }\r\n    }\r\n\r\n    private async getDevices(): Promise<MediaDeviceInfo[]> {\r\n        let devices: MediaDeviceInfo[] = null;\r\n        for (let i = 0; i < 3; ++i) {\r\n            devices = await navigator.mediaDevices.enumerateDevices();\r\n            for (const device of devices) {\r\n                if (device.deviceId.length > 0) {\r\n                    this.hasAudioPermission = this.hasAudioPermission || device.kind === \"audioinput\" && device.label.length > 0;\r\n                    this.hasVideoPermission = this.hasVideoPermission || device.kind === \"videoinput\" && device.label.length > 0;\r\n                }\r\n            }\r\n\r\n            if (this.hasAudioPermission) {\r\n                break;\r\n            }\r\n\r\n            try {\r\n                await navigator.mediaDevices.getUserMedia({\r\n                    audio: this.needsAudioDevice && !this.hasAudioPermission,\r\n                    video: this.needsVideoDevice && !this.hasVideoPermission\r\n                });\r\n            }\r\n            catch (exp) {\r\n                console.warn(exp);\r\n            }\r\n        }\r\n\r\n        return devices || [];\r\n    }\r\n\r\n    async getMediaPermissions(): Promise<MediaPermissionSet> {\r\n        await this.getDevices();\r\n        return {\r\n            audio: this.hasAudioPermission,\r\n            video: this.hasVideoPermission\r\n        };\r\n    }\r\n\r\n    private async getAvailableDevices(filterDuplicates: boolean = false): Promise<MediaDeviceSet> {\r\n        let devices = await this.getDevices();\r\n\r\n        if (filterDuplicates) {\r\n            devices = filterDeviceDuplicates(devices);\r\n        }\r\n\r\n        return {\r\n            audioOutput: canChangeAudioOutput ? devices.filter(d => d.kind === \"audiooutput\") : [],\r\n            audioInput: devices.filter(d => d.kind === \"audioinput\"),\r\n            videoInput: devices.filter(d => d.kind === \"videoinput\")\r\n        };\r\n    }\r\n\r\n    async getAudioInputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.audioInput || [];\r\n    }\r\n\r\n    async getVideoInputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.videoInput || [];\r\n    }\r\n\r\n    async setAudioOutputDevice(device: MediaDeviceInfo) {\r\n        if (canChangeAudioOutput) {\r\n            this.preferredAudioOutputID = device && device.deviceId || null;\r\n        }\r\n    }\r\n\r\n    async getAudioOutputDevices(filterDuplicates: boolean = false): Promise<MediaDeviceInfo[]> {\r\n        if (!canChangeAudioOutput) {\r\n            return [];\r\n        }\r\n        const devices = await this.getAvailableDevices(filterDuplicates);\r\n        return devices && devices.audioOutput || [];\r\n    }\r\n\r\n    async getCurrentAudioOutputDevice() {\r\n        if (!canChangeAudioOutput) {\r\n            return null;\r\n        }\r\n        const curId = this.audio.getAudioOutputDeviceID(),\r\n            devices = await this.getAudioOutputDevices(),\r\n            device = devices.filter((d) => curId != null && d.deviceId === curId\r\n                || curId == null && d.deviceId === this.preferredAudioOutputID);\r\n        if (device.length === 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            return device[0];\r\n        }\r\n    }\r\n\r\n    get preferredAudioOutputID(): string {\r\n        return localStorage.getItem(PREFERRED_AUDIO_OUTPUT_ID_KEY);\r\n    }\r\n\r\n    set preferredAudioOutputID(v: string) {\r\n        localStorage.setItem(PREFERRED_AUDIO_OUTPUT_ID_KEY, v);\r\n    }\r\n\r\n\r\n    async getPreferredAudioOutput(allowAny: boolean): Promise<MediaDeviceInfo> {\r\n        const devices = await this.getAudioOutputDevices();\r\n        const device = arrayScan(\r\n            devices,\r\n            (d) => d.deviceId === this.preferredAudioOutputID,\r\n            (d) => d.deviceId === \"communications\",\r\n            (d) => d.deviceId === \"default\",\r\n            (d) => allowAny && d.deviceId.length > 0);\r\n        return device;\r\n    }\r\n\r\n    async setPreferredAudioOutput(allowAny: boolean): Promise<void> {\r\n        const device = await this.getPreferredAudioOutput(allowAny);\r\n        if (device) {\r\n            await this.setAudioOutputDevice(device);\r\n        }\r\n    }\r\n\r\n    async setAudioInputDevice(device: MediaDeviceInfo): Promise<void> {\r\n        this.preferredAudioInputID = device && device.deviceId || null;\r\n    }\r\n\r\n    async setVideoInputDevice(device: MediaDeviceInfo) {\r\n        this.preferredVideoInputID = device && device.deviceId || null;\r\n    }\r\n\r\n    async connect(): Promise<void> {\r\n        this.setConnectionState(ConnectionState.Connecting);\r\n    }\r\n\r\n    async join(_roomName: string, _password?: string): Promise<void> {\r\n        this.setConferenceState(ConnectionState.Connecting);\r\n    }\r\n\r\n    async leave(): Promise<void> {\r\n        this.setConferenceState(ConnectionState.Disconnecting);\r\n    }\r\n\r\n    async disconnect(): Promise<void> {\r\n        this.setConnectionState(ConnectionState.Disconnecting);\r\n    }\r\n\r\n    abstract userExists(id: string): boolean;\r\n    abstract getUserNames(): string[][];\r\n    abstract identify(userNameOrID: string): Promise<void>;\r\n    abstract getCurrentAudioInputDevice(): Promise<MediaDeviceInfo>;\r\n    abstract getCurrentVideoInputDevice(): Promise<MediaDeviceInfo>;\r\n    abstract toggleAudioMuted(): Promise<boolean>;\r\n    abstract toggleVideoMuted(): Promise<boolean>;\r\n    abstract getAudioMuted(): Promise<boolean>;\r\n    abstract getVideoMuted(): Promise<boolean>;\r\n    abstract getDefaultMetadataClient(): IMetadataClientExt;\r\n}\r\n","/**\r\n * An Event class for tracking changes to audio activity.\r\n **/\r\nexport class AudioActivityEvent extends Event {\r\n    id: string = null;\r\n    isActive: boolean = false;\r\n\r\n    /** Creates a new \"audioActivity\" event */\r\n    constructor() {\r\n        super(\"audioActivity\");\r\n        Object.seal(this);\r\n    }\r\n\r\n    /**\r\n     * Sets the current state of the event\r\n     * @param id - the user for which the activity changed\r\n     * @param isActive - the new state of the activity\r\n     */\r\n    set(id: string, isActive: boolean): void {\r\n        this.id = id;\r\n        this.isActive = isActive;\r\n    }\r\n}\r\n","import type { Emoji } from \"kudzu/emoji/Emoji\";\r\nimport { TypedEventBase } from \"kudzu/events/EventBase\";\r\nimport type { IFetcher } from \"kudzu/io/IFetcher\";\r\nimport type { IDisposable } from \"kudzu/using\";\r\nimport { AudioActivityEvent } from \"./audio/AudioActivityEvent\";\r\nimport type { AudioManager } from \"./audio/AudioManager\";\r\nimport { canChangeAudioOutput } from \"./audio/canChangeAudioOutput\";\r\nimport type {\r\n    CallaAudioStreamAddedEvent,\r\n    CallaAudioStreamRemovedEvent,\r\n    CallaClientEvents,\r\n    CallaConferenceJoinedEvent,\r\n    CallaConferenceLeftEvent,\r\n    CallaParticipantJoinedEvent,\r\n    CallaParticipantLeftEvent,\r\n    CallaUserPointerEvent,\r\n    CallaUserPosedEvent\r\n} from \"./CallaEvents\";\r\nimport { ConnectionState } from \"./ConnectionState\";\r\nimport type { ICombinedClient } from \"./ICombinedClient\";\r\nimport type { IMetadataClient, IMetadataClientExt } from \"./meta/IMetadataClient\";\r\nimport type { ITeleconferenceClient, ITeleconferenceClientExt } from \"./tele/ITeleconferenceClient\";\r\n\r\nexport interface MediaPermissionSet {\r\n    audio: boolean;\r\n    video: boolean;\r\n}\r\n\r\nexport interface MediaDeviceSet {\r\n    audioInput: MediaDeviceInfo[];\r\n    videoInput: MediaDeviceInfo[];\r\n    audioOutput: MediaDeviceInfo[];\r\n}\r\n\r\nexport enum ClientState {\r\n    InConference = \"in-conference\",\r\n    JoiningConference = \"joining-conference\",\r\n    Connected = \"connected\",\r\n    Connecting = \"connecting\",\r\n    Prepaired = \"prepaired\",\r\n    Prepairing = \"prepairing\",\r\n    Unprepared = \"unprepaired\"\r\n}\r\n\r\nconst audioActivityEvt = new AudioActivityEvent();\r\n\r\nexport class Calla\r\n    extends TypedEventBase<CallaClientEvents>\r\n    implements ICombinedClient, IDisposable {\r\n\r\n    isAudioMuted: boolean = null;\r\n    isVideoMuted: boolean = null;\r\n\r\n    constructor(\r\n        private _fetcher: IFetcher,\r\n        private _tele: ITeleconferenceClientExt,\r\n        private _meta: IMetadataClientExt) {\r\n        super();\r\n\r\n        const fwd = this.dispatchEvent.bind(this);\r\n\r\n        this._tele.addEventListener(\"serverConnected\", fwd);\r\n        this._tele.addEventListener(\"serverDisconnected\", fwd);\r\n        this._tele.addEventListener(\"serverFailed\", fwd);\r\n        this._tele.addEventListener(\"conferenceFailed\", fwd);\r\n        this._tele.addEventListener(\"conferenceRestored\", fwd);\r\n\r\n        this._tele.addEventListener(\"audioMuteStatusChanged\", fwd);\r\n        this._tele.addEventListener(\"videoMuteStatusChanged\", fwd);\r\n\r\n        this._tele.addEventListener(\"conferenceJoined\", async (evt: CallaConferenceJoinedEvent) => {\r\n            const user = this.audio.setLocalUserID(evt.id);\r\n            evt.pose = user.pose;\r\n            this.dispatchEvent(evt);\r\n            await this.setPreferredDevices();\r\n        });\r\n\r\n        this._tele.addEventListener(\"conferenceLeft\", (evt: CallaConferenceLeftEvent) => {\r\n            this.audio.setLocalUserID(evt.id);\r\n            this.dispatchEvent(evt);\r\n        });\r\n\r\n        this._tele.addEventListener(\"participantJoined\", async (joinEvt: CallaParticipantJoinedEvent) => {\r\n            joinEvt.source = this.audio.createUser(joinEvt.id);\r\n            this.dispatchEvent(joinEvt);\r\n        });\r\n\r\n        this._tele.addEventListener(\"participantLeft\", (evt: CallaParticipantLeftEvent) => {\r\n            this.dispatchEvent(evt);\r\n            this.audio.removeUser(evt.id);\r\n        });\r\n\r\n        this._tele.addEventListener(\"userNameChanged\", fwd);\r\n        this._tele.addEventListener(\"videoAdded\", fwd);\r\n        this._tele.addEventListener(\"videoRemoved\", fwd);\r\n\r\n        this._tele.addEventListener(\"audioAdded\", (evt: CallaAudioStreamAddedEvent) => {\r\n            const user = this.audio.getUser(evt.id);\r\n            if (user) {\r\n                let stream = user.streams.get(evt.kind);\r\n                if (stream) {\r\n                    user.streams.delete(evt.kind);\r\n                }\r\n\r\n                stream = evt.stream;\r\n                user.streams.set(evt.kind, stream);\r\n\r\n                if (evt.id !== this._tele.localUserID) {\r\n                    this.audio.setUserStream(evt.id, stream);\r\n                }\r\n\r\n                this.dispatchEvent(evt);\r\n            }\r\n        });\r\n\r\n        this._tele.addEventListener(\"audioRemoved\", (evt: CallaAudioStreamRemovedEvent) => {\r\n            const user = this.audio.getUser(evt.id);\r\n            if (user && user.streams.has(evt.kind)) {\r\n                user.streams.delete(evt.kind);\r\n            }\r\n\r\n            if (evt.id !== this._tele.localUserID) {\r\n                this.audio.setUserStream(evt.id, null);\r\n            }\r\n\r\n            this.dispatchEvent(evt);\r\n        });\r\n\r\n        this._meta.addEventListener(\"avatarChanged\", fwd);\r\n        this._meta.addEventListener(\"chat\", fwd);\r\n        this._meta.addEventListener(\"emote\", fwd);\r\n        this._meta.addEventListener(\"setAvatarEmoji\", fwd);\r\n\r\n        const offsetEvt = (poseEvt: CallaUserPointerEvent | CallaUserPosedEvent): void => {\r\n            const O = this.audio.getUserOffset(poseEvt.id);\r\n            if (O) {\r\n                poseEvt.px += O[0];\r\n                poseEvt.py += O[1];\r\n                poseEvt.pz += O[2];\r\n            }\r\n            this.dispatchEvent(poseEvt);\r\n        };\r\n\r\n        this._meta.addEventListener(\"userPointer\", offsetEvt);\r\n\r\n        this._meta.addEventListener(\"userPosed\", (evt: CallaUserPosedEvent) => {\r\n            this.audio.setUserPose(\r\n                evt.id,\r\n                evt.px, evt.py, evt.pz,\r\n                evt.fx, evt.fy, evt.fz,\r\n                evt.ux, evt.uy, evt.uz);\r\n            offsetEvt(evt);\r\n        });\r\n\r\n        this.audio.addEventListener(\"audioActivity\", (evt: AudioActivityEvent) => {\r\n            audioActivityEvt.id = evt.id;\r\n            audioActivityEvt.isActive = evt.isActive;\r\n            this.dispatchEvent(audioActivityEvt);\r\n        });\r\n\r\n        const dispose = this.dispose.bind(this);\r\n        window.addEventListener(\"beforeunload\", dispose);\r\n        window.addEventListener(\"unload\", dispose);\r\n        window.addEventListener(\"pagehide\", dispose);\r\n\r\n        Object.seal(this);\r\n    }\r\n\r\n    get connectionState(): ConnectionState {\r\n        return this._tele.connectionState;\r\n    }\r\n\r\n    get conferenceState(): ConnectionState {\r\n        return this._tele.conferenceState;\r\n    }\r\n\r\n    get fetcher(): IFetcher {\r\n        return this._fetcher;\r\n    }\r\n\r\n    get tele(): ITeleconferenceClient {\r\n        return this._tele;\r\n    }\r\n\r\n    get meta(): IMetadataClient {\r\n        return this._meta;\r\n    }\r\n\r\n    get audio(): AudioManager {\r\n        return this._tele.audio;\r\n    }\r\n\r\n    get preferredAudioOutputID(): string {\r\n        return this._tele.preferredAudioOutputID;\r\n    }\r\n\r\n    set preferredAudioOutputID(v: string) {\r\n        this._tele.preferredAudioOutputID = v;\r\n    }\r\n\r\n    get preferredAudioInputID(): string {\r\n        return this._tele.preferredAudioInputID;\r\n    }\r\n\r\n    set preferredAudioInputID(v: string) {\r\n        this._tele.preferredAudioInputID = v;\r\n    }\r\n\r\n    get preferredVideoInputID(): string {\r\n        return this._tele.preferredVideoInputID;\r\n    }\r\n\r\n    set preferredVideoInputID(v: string) {\r\n        this._tele.preferredVideoInputID = v;\r\n    }\r\n\r\n    async getCurrentAudioOutputDevice(): Promise<MediaDeviceInfo> {\r\n        return await this._tele.getCurrentAudioOutputDevice();\r\n    }\r\n\r\n    async getMediaPermissions(): Promise<MediaPermissionSet> {\r\n        return await this._tele.getMediaPermissions();\r\n    }\r\n\r\n    async getAudioOutputDevices(filterDuplicates: boolean): Promise<MediaDeviceInfo[]> {\r\n        return await this._tele.getAudioOutputDevices(filterDuplicates);\r\n    }\r\n\r\n    async getAudioInputDevices(filterDuplicates: boolean): Promise<MediaDeviceInfo[]> {\r\n        return await this._tele.getAudioInputDevices(filterDuplicates);\r\n    }\r\n\r\n    async getVideoInputDevices(filterDuplicates: boolean): Promise<MediaDeviceInfo[]> {\r\n        return await this._tele.getVideoInputDevices(filterDuplicates);\r\n    }\r\n\r\n    dispose(): void {\r\n        this.leave();\r\n        this.disconnect();\r\n    }\r\n\r\n    get offsetRadius(): number {\r\n        return this.audio.offsetRadius;\r\n    }\r\n\r\n    set offsetRadius(v: number) {\r\n        this.audio.offsetRadius = v;\r\n    }\r\n\r\n    setLocalPose(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.audio.setUserPose(this.localUserID, px, py, pz, fx, fy, fz, ux, uy, uz, 0);\r\n        this._meta.setLocalPose(px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setLocalPoseImmediate(px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this.audio.setUserPose(this.localUserID, px, py, pz, fx, fy, fz, ux, uy, uz, 0);\r\n        this._meta.setLocalPoseImmediate(px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setLocalPointer(name: string, px: number, py: number, pz: number, fx: number, fy: number, fz: number, ux: number, uy: number, uz: number): void {\r\n        this._meta.setLocalPointer(name, px, py, pz, fx, fy, fz, ux, uy, uz);\r\n    }\r\n\r\n    setAvatarEmoji(emoji: Emoji): void {\r\n        this._meta.setAvatarEmoji(emoji);\r\n    }\r\n\r\n    setAvatarURL(url: string): void {\r\n        this._meta.setAvatarURL(url);\r\n    }\r\n\r\n    emote(emoji: Emoji): void {\r\n        this._meta.emote(emoji);\r\n    }\r\n\r\n    chat(text: string): void {\r\n        this._meta.chat(text);\r\n    }\r\n\r\n    async setPreferredDevices(): Promise<void> {\r\n        await this._tele.setPreferredDevices();\r\n    }\r\n\r\n    async setAudioInputDevice(device: MediaDeviceInfo): Promise<void> {\r\n        await this._tele.setAudioInputDevice(device);\r\n    }\r\n\r\n    async setVideoInputDevice(device: MediaDeviceInfo): Promise<void> {\r\n        await this._tele.setVideoInputDevice(device);\r\n    }\r\n\r\n    async getCurrentAudioInputDevice(): Promise<MediaDeviceInfo> {\r\n        return await this._tele.getCurrentAudioInputDevice();\r\n    }\r\n\r\n    async getCurrentVideoInputDevice(): Promise<MediaDeviceInfo> {\r\n        return await this._tele.getCurrentVideoInputDevice();\r\n    }\r\n\r\n    async toggleAudioMuted(): Promise<boolean> {\r\n        return await this._tele.toggleAudioMuted();\r\n    }\r\n\r\n    async toggleVideoMuted(): Promise<boolean> {\r\n        return await this._tele.toggleVideoMuted();\r\n    }\r\n\r\n    async getAudioMuted(): Promise<boolean> {\r\n        return await this._tele.getAudioMuted();\r\n    }\r\n\r\n    async getVideoMuted(): Promise<boolean> {\r\n        return await this._tele.getVideoMuted();\r\n    }\r\n\r\n    get metadataState(): ConnectionState {\r\n        return this._meta.metadataState;\r\n    }\r\n\r\n    get localUserID() {\r\n        return this._tele.localUserID;\r\n    }\r\n\r\n    get localUserName() {\r\n        return this._tele.localUserName;\r\n    }\r\n\r\n    get roomName() {\r\n        return this._tele.roomName;\r\n    }\r\n\r\n    userExists(id: string): boolean {\r\n        return this._tele.userExists(id);\r\n    }\r\n\r\n    getUserNames(): string[][] {\r\n        return this._tele.getUserNames();\r\n    }\r\n\r\n    async connect(): Promise<void> {\r\n        await this._tele.connect();\r\n        if (this._tele.connectionState === ConnectionState.Connected) {\r\n            await this._meta.connect();\r\n        }\r\n    }\r\n\r\n    async join(roomName: string): Promise<void> {\r\n        await this._tele.join(roomName);\r\n        if (this._tele.conferenceState === ConnectionState.Connected) {\r\n            await this._meta.join(roomName);\r\n        }\r\n    }\r\n\r\n    async identify(userName: string): Promise<void> {\r\n        await this._tele.identify(userName);\r\n        await this._meta.identify(this.localUserID);\r\n    }\r\n\r\n    async leave(): Promise<void> {\r\n        await this._meta.leave();\r\n        await this._tele.leave();\r\n    }\r\n\r\n    async disconnect(): Promise<void> {\r\n        await this._meta.disconnect();\r\n        await this._tele.disconnect();\r\n    }\r\n\r\n    update(): void {\r\n        this.audio.update();\r\n    }\r\n\r\n    async setAudioOutputDevice(device: MediaDeviceInfo) {\r\n        this._tele.setAudioOutputDevice(device);\r\n        if (canChangeAudioOutput) {\r\n            await this.audio.setAudioOutputDeviceID(this._tele.preferredAudioOutputID);\r\n        }\r\n    }\r\n\r\n    async setAudioMuted(muted: boolean) {\r\n        let isMuted = this.isAudioMuted;\r\n        if (muted !== isMuted) {\r\n            isMuted = await this.toggleAudioMuted();\r\n        }\r\n        return isMuted;\r\n    }\r\n\r\n    async setVideoMuted(muted: boolean) {\r\n        let isMuted = this.isVideoMuted;\r\n        if (muted !== isMuted) {\r\n            isMuted = await this.toggleVideoMuted();\r\n        }\r\n        return isMuted;\r\n    }\r\n\r\n}","export * from \"./audio/canChangeAudioOutput\";\r\nexport * from \"./meta/BaseMetadataClient\";\r\nexport * from \"./tele/BaseTeleconferenceClient\";\r\nexport { Calla as Client } from \"./Calla\";\r\nexport {\r\n    CallaTeleconferenceEventType as TeleconferenceEvents,\r\n    CallaMetadataEventType as MetadataEvents\r\n} from \"./CallaEvents\";\r\n\r\nimport { version } from \"./package.json\";\r\nconsole.info(`Calla v${version}.`);\r\n\r\nexport { version };"],"names":[],"mappings":"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"}